---
title: API 라우팅
date: '2023-01-01 02:06'
summary: Next.js에서 API 라우트를 생성하고 최적의 사용 방법과 함께 미리보기 및 동적 라우팅을 학습합니다.
---

<TOCInline toc={props.toc} asDisclosure />

## API 라우트

Next.js는 API 라우트 지원을 통해 Node.js 서버리스 함수로 API 엔드포인트를 쉽게 생성할 수 있습니다. 블로그 앱에는 필요하지 않지만 이 수업에서는 어떻게 사용하는지 간단히 알아보겠습니다.

이 수업에서 배울 내용:
이 수업에서는 다음을 배울 수 있습니다:

- API 라우트를 생성하는 방법
- API 라우트에 대한 유용한 정보

## API 라우트 생성하기
API 라우트를 사용하면 Next.js 앱 내에서 API 엔드포인트를 생성할 수 있습니다. 이는 `pages/api` 디렉토리 내에 다음 형식의 함수를 생성함으로써 가능합니다:
```jsx
// req = HTTP 요청 메시지, res = HTTP 서버 응답
export default function handler(req, res) {
  // ...
}
```
API 라우트 문서에서 위의 요청 핸들러에 대해 더 자세히 알아보세요.

이들은 서버리스 함수(람다라고도 함)로 배포될 수 있습니다.

간단한 API 엔드포인트 생성하기
시도해봅시다. `pages/api`에 `hello.js` 파일을 생성하고 다음 코드를 작성하세요:
```jsx
export default function handler(req, res) {
  res.status(200).json({ text: 'Hello' });
}
```
http://localhost:3000/api/hello에서 접속해보세요. `{"text":"Hello"}`를 볼 수 있습니다. 주의할 점:

- req는 http.IncomingMessage의 인스턴스이며, 사전 구축된 미들웨어가 포함되어 있습니다.
- res는 http.ServerResponse의 인스턴스이며, 몇 가지 도움 함수가 포함되어 있습니다.

그게 다입니다! 이 수업을 마치기 전에 다음 페이지에서 API 라우트를 사용할 때의 몇 가지 팁에 대해 논의해보겠습니다.

## API 라우트 세부 사항
API 라우트에 대해 알아야 할 중요한 정보가 있습니다.

### `getStaticProps` 또는 `getStaticPaths`에서 API 라우트를 가져오지 마세요
`getStaticProps` 또는 `getStaticPaths`에서 API 라우트를 가져오면 안됩니다. 대신, `getStaticProps` 또는 `getStaticPaths` 내에서 서버 측 코드를 직접 작성하세요(또는 도우미 함수를 호출하세요).

이유는 다음과 같습니다: `getStaticProps`와 `getStaticPaths`는 서버 측에서만 실행되며 클라이언트 측에서는 절대 실행되지 않습니다. 게다가, 이 함수들은 브라우저를 위한 JS 번들에 포함되지 않습니다. 따라서 데이터베이스 질의와 같은 코드를 작성해도 브라우저로 전송되지 않습니다. 서버 측 코드 작성 문서에서 더 자세히 알아보세요.

### 좋은 사용 사례: 폼 입력 처리
API 라우트의 좋은 사용 사례는 폼 입력을 처리하는 것입니다. 예를 들어 페이지에서 폼을 생성하고, 해당 폼이 API 라우트에 `POST` 요청을 보낼 수 있게 할 수 있습니다. 그런 다음 데이터를 직접 데이터베이스에 저장하기 위한 코드를 작성할 수 있습니다. API 라우트 코드는 클라이언트 번들의 일부가 아니므로 서버 측 코드를 안전하게 작성할 수 있습니다.
```jsx
export default function handler(req, res) {
  const email = req.body.email;
  // 그런 다음 이메일을 데이터베이스에 저장 등...
}
```

### 미리보기 모드
헤드리스 CMS에서 데이터를 가져올 때 정적 생성이 유용합니다. 그러나 헤드리스 CMS에서 초안을 작성하고 페이지에서 해당 초안을 즉시 미리보기하려고 할 때는 이상적이지 않습니다. 빌드 시간이 아닌 요청 시간에 페이지를 렌더링하고 출판된 내용 대신 초안 내용을 가져오기를 원할 것입니다. 이 특정 경우에만 Next.js가 정적 생성을 우회하도록 하고 싶을 것입니다.

위의 문제를 해결하기 위해 Next.js에는 미리보기 모드라는 기능이 있으며, 이는 API 라우트를 활용합니다. 더 자세한 내용은 미리보기 모드 문서를 참고하세요.

### 동적 API 라우트
API 라우트는 일반 페이지와 마찬가지로 동적일 수 있습니다. 더 알아보려면 동적 API 라우트 문서를 참고하세요.

